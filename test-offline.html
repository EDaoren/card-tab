<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>离线模式测试</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="fonts/material-symbols-rounded.css">
    <link rel="stylesheet" href="styles/offline-icons.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        
        .status-display {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 500;
        }
        
        .status-online {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-offline {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .icon-test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .icon-test-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: white;
            border-radius: 6px;
            border: 1px solid #eee;
        }
        
        .search-engine-test {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 6px;
            border: 1px solid #eee;
        }
        
        .test-controls {
            margin: 20px 0;
        }
        
        .test-btn {
            background: #4285f4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        .test-btn:hover {
            background: #3367d6;
        }
        
        .test-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .log-area {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            font-family: monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>🧪 离线模式测试</h1>
    
    <div id="network-status" class="status-display">
        检测网络状态中...
    </div>
    
    <div class="test-section">
        <h2>🌐 网络状态控制</h2>
        <p>使用浏览器开发者工具模拟离线状态：</p>
        <ol>
            <li>按 F12 打开开发者工具</li>
            <li>切换到 Network 面板</li>
            <li>点击 "Offline" 复选框模拟离线状态</li>
            <li>观察页面变化</li>
        </ol>
        
        <div class="test-controls">
            <button class="test-btn" onclick="testNetworkStatus()">检测当前网络状态</button>
            <button class="test-btn" onclick="simulateOffline()">模拟离线模式</button>
            <button class="test-btn" onclick="simulateOnline()">模拟在线模式</button>
        </div>
    </div>
    
    <div class="test-section">
        <h2>🔍 搜索引擎图标测试</h2>
        <p>在离线状态下，外部图标会被替换为本地绘制的图标：</p>
        
        <div class="search-engine-test">
            <img src="https://www.google.com/favicon.ico" alt="Google" class="search-engine-icon">
            <div class="search-engine-icon offline-google" style="display: none;"></div>
            <span>Google 搜索</span>
        </div>
        
        <div class="search-engine-test">
            <img src="https://www.bing.com/favicon.ico" alt="Bing" class="search-engine-icon">
            <div class="search-engine-icon offline-bing" style="display: none;"></div>
            <span>Bing 搜索</span>
        </div>
        
        <div class="search-engine-test">
            <img src="https://www.baidu.com/favicon.ico" alt="Baidu" class="search-engine-icon">
            <div class="search-engine-icon offline-baidu" style="display: none;"></div>
            <span>百度搜索</span>
        </div>
        
        <div class="search-engine-test">
            <img src="https://duckduckgo.com/favicon.ico" alt="DuckDuckGo" class="search-engine-icon">
            <div class="search-engine-icon offline-duckduckgo" style="display: none;"></div>
            <span>DuckDuckGo 搜索</span>
        </div>
    </div>
    
    <div class="test-section">
        <h2>🎨 Material Symbols 图标测试</h2>
        <p>这些图标使用本地字体，在离线状态下应该正常显示：</p>
        
        <div class="icon-test-grid">
            <div class="icon-test-item">
                <span class="material-symbols-rounded">search</span>
                <span>search</span>
            </div>
            <div class="icon-test-item">
                <span class="material-symbols-rounded">palette</span>
                <span>palette</span>
            </div>
            <div class="icon-test-item">
                <span class="material-symbols-rounded">grid_view</span>
                <span>grid_view</span>
            </div>
            <div class="icon-test-item">
                <span class="material-symbols-rounded">view_list</span>
                <span>view_list</span>
            </div>
            <div class="icon-test-item">
                <span class="material-symbols-rounded">add</span>
                <span>add</span>
            </div>
            <div class="icon-test-item">
                <span class="material-symbols-rounded">sync</span>
                <span>sync</span>
            </div>
            <div class="icon-test-item">
                <span class="material-symbols-rounded">download</span>
                <span>download</span>
            </div>
            <div class="icon-test-item">
                <span class="material-symbols-rounded">cloud_upload</span>
                <span>cloud_upload</span>
            </div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>📝 测试日志</h2>
        <div id="test-log" class="log-area">
            等待测试开始...
        </div>
        <div class="test-controls">
            <button class="test-btn" onclick="clearLog()">清空日志</button>
            <button class="test-btn" onclick="runFullTest()">运行完整测试</button>
        </div>
    </div>

    <script src="js/offline-manager.js"></script>
    <script>
        let testLog = '';
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            testLog += `[${timestamp}] ${message}\n`;
            document.getElementById('test-log').textContent = testLog;
            console.log(message);
        }
        
        function updateNetworkStatus() {
            const statusEl = document.getElementById('network-status');
            const isOnline = navigator.onLine;
            
            if (isOnline) {
                statusEl.className = 'status-display status-online';
                statusEl.textContent = '🟢 在线状态 - 所有功能可用';
            } else {
                statusEl.className = 'status-display status-offline';
                statusEl.textContent = '🔴 离线状态 - 部分功能受限';
            }
            
            log(`网络状态: ${isOnline ? '在线' : '离线'}`);
        }
        
        function testNetworkStatus() {
            updateNetworkStatus();
            
            if (window.offlineManager) {
                const status = offlineManager.getNetworkStatus();
                log(`离线管理器状态: ${JSON.stringify(status)}`);
            }
        }
        
        function simulateOffline() {
            log('模拟离线状态...');
            document.body.classList.add('offline-mode');
            
            if (window.offlineManager) {
                offlineManager.handleOfflineMode();
            }
        }
        
        function simulateOnline() {
            log('模拟在线状态...');
            document.body.classList.remove('offline-mode');
            
            if (window.offlineManager) {
                offlineManager.handleOnlineMode();
            }
        }
        
        function clearLog() {
            testLog = '';
            document.getElementById('test-log').textContent = '日志已清空';
        }
        
        function runFullTest() {
            log('开始运行完整测试...');
            
            // 测试网络状态
            testNetworkStatus();
            
            // 测试图标显示
            const materialIcons = document.querySelectorAll('.material-symbols-rounded');
            log(`发现 ${materialIcons.length} 个 Material Symbols 图标`);
            
            // 测试搜索引擎图标
            const searchEngineIcons = document.querySelectorAll('.search-engine-icon');
            log(`发现 ${searchEngineIcons.length} 个搜索引擎图标`);
            
            // 测试离线管理器
            if (window.offlineManager) {
                log('离线管理器已加载');
                const status = offlineManager.getNetworkStatus();
                log(`管理器状态: ${JSON.stringify(status)}`);
            } else {
                log('⚠️ 离线管理器未加载');
            }
            
            log('完整测试完成');
        }
        
        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            log('页面加载完成');
            updateNetworkStatus();
            
            // 初始化离线管理器
            if (window.offlineManager) {
                offlineManager.init();
                log('离线管理器已初始化');
            }
            
            // 监听网络状态变化
            window.addEventListener('online', () => {
                log('网络已连接');
                updateNetworkStatus();
            });
            
            window.addEventListener('offline', () => {
                log('网络已断开');
                updateNetworkStatus();
            });
        });
    </script>
</body>
</html>
