<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>背景图片Supabase策略测试</title>
  <link rel="stylesheet" href="styles/main.css">
  <link rel="stylesheet" href="fonts/material-symbols-rounded.css">
</head>
<body>
  <!-- 背景容器 -->
  <div class="background-container"></div>
  <div class="background-overlay"></div>

  <div class="container">
    <h1>背景图片功能测试</h1>
    
    <div style="margin-bottom: 30px;">
      <h2>当前状态</h2>
      <div id="status-info" style="padding: 15px; background: #f5f5f5; border-radius: 8px; margin-bottom: 20px;">
        <p><strong>Supabase状态:</strong> <span id="supabase-status">检测中...</span></p>
        <p><strong>背景图片功能:</strong> <span id="bg-feature-status">检测中...</span></p>
      </div>
      
      <button onclick="checkStatus()" class="secondary-btn">刷新状态</button>
      <button onclick="openThemeModal()" class="save-btn">打开主题设置</button>
    </div>

    <div style="margin-bottom: 30px;">
      <h2>模拟场景测试</h2>
      <button onclick="simulateNoSupabase()" class="secondary-btn">模拟未配置Supabase</button>
      <button onclick="simulateWithSupabase()" class="secondary-btn">模拟已配置Supabase</button>
    </div>
  </div>

  <!-- 主题设置模态框 -->
  <div id="theme-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>主题和背景设置</h2>
        <button class="close-modal">×</button>
      </div>
      <div class="modal-body">
        <div class="theme-options">
          <div class="theme-option active" data-theme="default">
            <div class="theme-preview theme-default"></div>
            <span>默认</span>
          </div>
          <div class="theme-option" data-theme="dark">
            <div class="theme-preview theme-dark"></div>
            <span>深色</span>
          </div>
          <div class="theme-option" data-theme="blue">
            <div class="theme-preview theme-blue"></div>
            <span>蓝色</span>
          </div>
        </div>
        
        <div class="bg-image-section">
          <h3>自定义背景图片</h3>
          
          <!-- 未配置Supabase时的提示界面 -->
          <div id="bg-setup-prompt" class="bg-setup-prompt" style="display: none;">
            <div class="setup-prompt-content">
              <div class="setup-prompt-icon">
                <span class="material-symbols-rounded">cloud_upload</span>
              </div>
              <h4>需要云端存储支持</h4>
              <p>背景图片功能支持高清4K图片，需要云端存储空间。</p>
              <p>配置Supabase后即可上传和同步您的个性化背景。</p>
              <button id="setup-supabase-btn" class="save-btn">
                <span class="material-symbols-rounded">settings</span>
                立即配置云端同步
              </button>
            </div>
          </div>
          
          <!-- 正常的背景图片设置界面 -->
          <div id="bg-image-controls" class="bg-image-controls">
            <div class="form-group">
              <div id="background-preview" class="background-preview">
                <img id="background-preview-img" src="" alt="背景预览">
                <div class="no-bg-placeholder">无背景图片</div>
              </div>
            </div>
            
            <div class="form-group">
              <label>上传背景图片</label>
              <input type="file" id="bg-image-upload" accept="image/*" class="file-input">
              <label for="bg-image-upload" class="file-input-label">
                <span class="material-symbols-rounded">upload_file</span>
                选择图片
              </label>
              <small>支持JPG、PNG格式，推荐使用高分辨率图片获得最佳效果</small>
            </div>
            
            <div class="form-group">
              <label for="bg-opacity">背景透明度</label>
              <div class="range-with-value">
                <input type="range" id="bg-opacity" min="0" max="100" value="30">
                <span id="bg-opacity-value">30%</span>
              </div>
            </div>
            
            <div class="form-actions centered">
              <button type="button" id="remove-bg-btn" class="delete-btn">移除背景图</button>
              <button type="button" id="apply-bg-btn" class="save-btn">应用背景</button>
            </div>
          </div>
        </div>
        
        <div class="form-actions centered">
          <button class="close-modal secondary-btn">关闭</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 模拟的同步设置模态框 -->
  <div id="sync-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>云端同步设置</h2>
        <button class="close-modal">×</button>
      </div>
      <div class="modal-body">
        <p>这是模拟的Supabase配置界面</p>
        <p>在实际应用中，这里会显示完整的Supabase配置表单。</p>
        <div class="form-actions centered">
          <button class="close-modal secondary-btn">关闭</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 包含必要的脚本 -->
  <script src="js/icons.js"></script>
  
  <script>
    // 模拟存储管理器
    window.storageManager = {
      loadData: async () => ({ categories: [], settings: {} }),
      saveData: async (data) => console.log('模拟保存数据:', data)
    };
    
    // 模拟同步管理器
    window.syncManager = {
      isSupabaseEnabled: false
    };
    
    // 模拟同步UI管理器
    window.syncUIManager = {
      openSyncModal: () => {
        document.getElementById('sync-modal').style.display = 'flex';
        setTimeout(() => document.getElementById('sync-modal').classList.add('show'), 10);
      }
    };
    
    // 模拟存储
    window.storage = {
      get: async (keys) => ({}),
      set: async (data) => console.log('模拟本地存储:', data)
    };
    
    // 模拟模态框函数
    window.openModal = (modal) => {
      modal.style.display = 'flex';
      setTimeout(() => modal.classList.add('show'), 10);
    };
    
    window.closeModal = (modal) => {
      modal.classList.remove('show');
      setTimeout(() => modal.style.display = 'none', 300);
    };
    
    // 绑定关闭按钮
    document.querySelectorAll('.close-modal').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const modal = e.target.closest('.modal');
        closeModal(modal);
      });
    });
    
    function checkStatus() {
      const supabaseStatus = document.getElementById('supabase-status');
      const bgFeatureStatus = document.getElementById('bg-feature-status');
      
      supabaseStatus.textContent = syncManager.isSupabaseEnabled ? '已配置' : '未配置';
      supabaseStatus.style.color = syncManager.isSupabaseEnabled ? '#28a745' : '#dc3545';
      
      bgFeatureStatus.textContent = syncManager.isSupabaseEnabled ? '可用' : '需要配置Supabase';
      bgFeatureStatus.style.color = syncManager.isSupabaseEnabled ? '#28a745' : '#dc3545';
      
      // 更新背景图片UI
      if (window.updateBackgroundImageUI) {
        updateBackgroundImageUI();
      }
    }
    
    function simulateNoSupabase() {
      syncManager.isSupabaseEnabled = false;
      checkStatus();
      console.log('模拟: Supabase未配置');
    }
    
    function simulateWithSupabase() {
      syncManager.isSupabaseEnabled = true;
      checkStatus();
      console.log('模拟: Supabase已配置');
    }
    
    function openThemeModal() {
      const modal = document.getElementById('theme-modal');
      openModal(modal);
      if (window.updateBackgroundImageUI) {
        updateBackgroundImageUI();
      }
    }
    
    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', () => {
      checkStatus();
    });
  </script>
  
  <script src="js/theme.js"></script>
  
  <script>
    // 初始化主题设置
    if (window.initThemeSettings) {
      initThemeSettings();
    }
  </script>
</body>
</html>
