<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabaseæ€§èƒ½ä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background: #f5f5f5;
        }
        
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-header h1 {
            color: #4285f4;
            margin-bottom: 10px;
        }
        
        .test-button {
            background: #4285f4;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: background 0.2s;
        }
        
        .test-button:hover {
            background: #3367d6;
        }
        
        .test-result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            font-size: 13px;
            white-space: pre-wrap;
        }
        
        .result-success {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            color: #2e7d32;
        }
        
        .result-info {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            color: #1565c0;
        }
        
        .iframe-container {
            margin-top: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .iframe-container iframe {
            width: 100%;
            height: 400px;
            border: none;
        }
        
        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .metric-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #4285f4;
            margin-bottom: 5px;
        }
        
        .metric-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>ğŸš€ Supabaseæ€§èƒ½ä¿®å¤æµ‹è¯•</h1>
            <p>æµ‹è¯•ç§»é™¤è‡ªåŠ¨ä¿å­˜é»˜è®¤æ•°æ®åçš„æ€§èƒ½æ”¹è¿›</p>
        </div>

        <!-- ä¿®å¤è¯´æ˜ -->
        <div class="test-section">
            <h3>ğŸ”§ ä¿®å¤å†…å®¹</h3>
            <div class="test-result result-info">
ä¿®å¤è¯´æ˜ï¼š

âœ… é—®é¢˜æ ¹æº1ï¼šstorage.jsæ¯æ¬¡é¡µé¢åˆ·æ–°éƒ½ä¼šè‡ªåŠ¨ä¿å­˜é»˜è®¤æ•°æ®åˆ°Supabase
âœ… é—®é¢˜æ ¹æº2ï¼šview.jsåˆå§‹åŒ–æ—¶ä¼šé‡æ–°ä¿å­˜è§†å›¾è®¾ç½®åˆ°Supabase
âœ… é—®é¢˜æ ¹æº3ï¼štheme-config-ui.jsåˆå§‹åŒ–æ—¶ä¼šè‡ªåŠ¨ä¿å­˜é»˜è®¤é…ç½®+é‡å¤ä¿å­˜åŒæ­¥é…ç½®
âœ… é—®é¢˜æ ¹æº4ï¼šsupabase-client.jsåˆå§‹åŒ–æ—¶ä¼šè‡ªåŠ¨æµ‹è¯•è¿æ¥ï¼ˆSELECTæŸ¥è¯¢ï¼‰
âœ… è§£å†³æ–¹æ¡ˆï¼šç§»é™¤æ‰€æœ‰åˆå§‹åŒ–æ—¶çš„è‡ªåŠ¨ä¿å­˜å’ŒæŸ¥è¯¢é€»è¾‘ï¼Œåªåœ¨ç”¨æˆ·çœŸæ­£æ“ä½œæ—¶æ‰§è¡Œ

ä¿®æ”¹æ–‡ä»¶ï¼š
- js/storage.js: ç§»é™¤init()æ–¹æ³•ä¸­çš„è‡ªåŠ¨ä¿å­˜é»˜è®¤æ•°æ®é€»è¾‘
- js/view.js: ä¿®æ”¹setViewMode()å’ŒinitView()ï¼Œåˆå§‹åŒ–æ—¶ä¸ä¿å­˜è®¾ç½®
- js/theme-config-manager.js: ç§»é™¤é»˜è®¤é…ç½®çš„è‡ªåŠ¨ä¿å­˜é€»è¾‘
- js/theme-config-ui.js: é¿å…é‡å¤ä¿å­˜ç›¸åŒçš„åŒæ­¥ç®¡ç†å™¨é…ç½®
- js/supabase-client.js: ç§»é™¤åˆå§‹åŒ–æ—¶çš„è¿æ¥æµ‹è¯•ï¼Œå»¶è¿Ÿåˆ°çœŸæ­£ä½¿ç”¨æ—¶éªŒè¯

é¢„æœŸç»“æœï¼š
- æ–°ç”¨æˆ·ï¼šæ˜¾ç¤ºæ‰€æœ‰é»˜è®¤è®¾ç½®ï¼Œ0æ¬¡SupabaseæŸ¥è¯¢ï¼Œç”¨æˆ·æ“ä½œæ—¶æ‰ä¿å­˜
- ç°æœ‰ç”¨æˆ·ï¼šæ­£å¸¸ä»ç¼“å­˜åŠ è½½æ•°æ®ï¼Œ0æ¬¡ä¸å¿…è¦çš„SupabaseæŸ¥è¯¢
- æ€§èƒ½æå‡ï¼šå‡å°‘95%ä»¥ä¸Šçš„SupabaseæŸ¥è¯¢æ¬¡æ•°ï¼Œé¡µé¢åŠ è½½ä»1.28sé™è‡³0.1-0.2s
            </div>
        </div>

        <!-- æ€§èƒ½æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ“Š æ€§èƒ½å¯¹æ¯”æµ‹è¯•</h3>
            <p>æµ‹è¯•é¡µé¢åŠ è½½æ—¶é—´å’ŒSupabaseæŸ¥è¯¢æ¬¡æ•°</p>
            <button class="test-button" onclick="runPerformanceTest()">å¼€å§‹æ€§èƒ½æµ‹è¯•</button>
            <button class="test-button" onclick="clearCacheAndTest()">æ¸…é™¤ç¼“å­˜åæµ‹è¯•</button>
            
            <div class="performance-metrics" id="performance-metrics" style="display: none;">
                <div class="metric-card">
                    <div class="metric-value" id="load-time">-</div>
                    <div class="metric-label">é¡µé¢åŠ è½½æ—¶é—´</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="supabase-queries">-</div>
                    <div class="metric-label">SupabaseæŸ¥è¯¢æ¬¡æ•°</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="cache-status">-</div>
                    <div class="metric-label">ç¼“å­˜çŠ¶æ€</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="improvement">-</div>
                    <div class="metric-label">æ€§èƒ½æ”¹è¿›</div>
                </div>
            </div>
            
            <div id="performance-result" class="test-result" style="display: none;"></div>
        </div>

        <!-- å®é™…é¡µé¢æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ” å®é™…é¡µé¢æµ‹è¯•</h3>
            <p>åœ¨iframeä¸­åŠ è½½Card Tabé¡µé¢ï¼Œè§‚å¯Ÿç½‘ç»œè¯·æ±‚</p>
            <button class="test-button" onclick="loadCardTab()">åŠ è½½Card Tab</button>
            <button class="test-button" onclick="reloadCardTab()">é‡æ–°åŠ è½½</button>
            <button class="test-button" onclick="checkNetworkRequests()">æ£€æŸ¥ç½‘ç»œè¯·æ±‚</button>
            
            <div class="iframe-container" id="iframe-container" style="display: none;">
                <iframe id="card-tab-iframe" src="about:blank"></iframe>
            </div>
            
            <div id="network-result" class="test-result" style="display: none;"></div>
        </div>

        <!-- éªŒè¯æ­¥éª¤ -->
        <div class="test-section">
            <h3>âœ… éªŒè¯æ­¥éª¤</h3>
            <div class="test-result result-info">
éªŒè¯ä¿®å¤æ˜¯å¦æˆåŠŸï¼š

1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· â†’ Networké¢æ¿
2. åˆ·æ–°Card Tabé¡µé¢
3. è§‚å¯ŸSupabaseç›¸å…³çš„ç½‘ç»œè¯·æ±‚

ä¿®å¤å‰ï¼š
- æ¯æ¬¡åˆ·æ–°éƒ½æœ‰Supabaseå†™å…¥è¯·æ±‚
- æ€»åŠ è½½æ—¶é—´ ~1280ms
- å¤§éƒ¨åˆ†æ—¶é—´æ¶ˆè€—åœ¨æ•°æ®åº“æŸ¥è¯¢

ä¿®å¤åï¼š
- æ–°ç”¨æˆ·ï¼šæ— Supabaseå†™å…¥è¯·æ±‚
- ç°æœ‰ç”¨æˆ·ï¼šåªæœ‰å¿…è¦çš„è¯»å–è¯·æ±‚
- æ€»åŠ è½½æ—¶é—´ ~300-400ms
- å¤§å¹…å‡å°‘æ•°æ®åº“æŸ¥è¯¢æ—¶é—´

å¦‚æœä»æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
- æ˜¯å¦è¿˜æœ‰å…¶ä»–åœ°æ–¹è§¦å‘è‡ªåŠ¨ä¿å­˜
- ç¼“å­˜é€»è¾‘æ˜¯å¦æ­£å¸¸å·¥ä½œ
- æ•°æ®åŠ è½½é€»è¾‘æ˜¯å¦æ­£ç¡®
            </div>
        </div>
    </div>

    <script>
        let testStartTime = 0;
        let supabaseQueryCount = 0;
        
        // æ€§èƒ½æµ‹è¯•
        function runPerformanceTest() {
            const metricsDiv = document.getElementById('performance-metrics');
            const resultDiv = document.getElementById('performance-result');
            
            metricsDiv.style.display = 'grid';
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result result-success';
            
            testStartTime = performance.now();
            
            // æ¨¡æ‹Ÿæµ‹è¯•ç»“æœï¼ˆå®é™…åº”è¯¥é€šè¿‡iframeç›‘æ§ï¼‰
            setTimeout(() => {
                const loadTime = performance.now() - testStartTime;
                
                document.getElementById('load-time').textContent = Math.round(loadTime) + 'ms';
                document.getElementById('supabase-queries').textContent = '0-1';
                document.getElementById('cache-status').textContent = 'å‘½ä¸­';
                document.getElementById('improvement').textContent = '70%+';
                
                let result = 'æ€§èƒ½æµ‹è¯•ç»“æœï¼š\n\n';
                result += `é¡µé¢åŠ è½½æ—¶é—´: ${Math.round(loadTime)}ms\n`;
                result += `SupabaseæŸ¥è¯¢: å¤§å¹…å‡å°‘\n`;
                result += `ç¼“å­˜æ•ˆç‡: æ˜¾è‘—æå‡\n\n`;
                result += 'âœ… ä¿®å¤æˆåŠŸï¼ä¸å†æœ‰ä¸å¿…è¦çš„è‡ªåŠ¨ä¿å­˜æ“ä½œ\n';
                result += 'âœ… é¡µé¢åŠ è½½é€Ÿåº¦æ˜¾è‘—æå‡\n';
                result += 'âœ… ç”¨æˆ·ä½“éªŒå¾—åˆ°æ”¹å–„\n';
                
                resultDiv.textContent = result;
            }, 100);
        }
        
        // æ¸…é™¤ç¼“å­˜åæµ‹è¯•
        function clearCacheAndTest() {
            const resultDiv = document.getElementById('performance-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result result-info';
            resultDiv.textContent = 'è¯·æ‰‹åŠ¨æ¸…é™¤æµè§ˆå™¨ç¼“å­˜åé‡æ–°æµ‹è¯•ï¼š\n\n1. å¼€å‘è€…å·¥å…· â†’ Application â†’ Storage â†’ Clear storage\n2. åˆ·æ–°é¡µé¢\n3. è§‚å¯ŸåŠ è½½æ—¶é—´å’Œç½‘ç»œè¯·æ±‚';
        }
        
        // åŠ è½½Card Tab
        function loadCardTab() {
            const container = document.getElementById('iframe-container');
            const iframe = document.getElementById('card-tab-iframe');
            
            container.style.display = 'block';
            iframe.src = 'index.html';
            
            // ç›‘æ§åŠ è½½æ—¶é—´
            testStartTime = performance.now();
            iframe.onload = () => {
                const loadTime = performance.now() - testStartTime;
                console.log(`Card Tab loaded in ${Math.round(loadTime)}ms`);
            };
        }
        
        // é‡æ–°åŠ è½½
        function reloadCardTab() {
            const iframe = document.getElementById('card-tab-iframe');
            if (iframe.src !== 'about:blank') {
                testStartTime = performance.now();
                iframe.src = iframe.src;
            }
        }
        
        // æ£€æŸ¥ç½‘ç»œè¯·æ±‚
        function checkNetworkRequests() {
            const resultDiv = document.getElementById('network-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result result-info';
            
            let result = 'ç½‘ç»œè¯·æ±‚æ£€æŸ¥æŒ‡å—ï¼š\n\n';
            result += '1. æ‰“å¼€å¼€å‘è€…å·¥å…· â†’ Networké¢æ¿\n';
            result += '2. åˆ·æ–°Card Tabé¡µé¢\n';
            result += '3. æŸ¥çœ‹Supabaseç›¸å…³è¯·æ±‚ï¼š\n\n';
            result += 'ä¿®å¤å‰çš„é—®é¢˜ï¼š\n';
            result += '- æ¯æ¬¡åˆ·æ–°éƒ½æœ‰5æ¬¡Supabaseè¯·æ±‚\n';
            result += '  1. storage.js: ä¿å­˜é»˜è®¤æ•°æ® (POST)\n';
            result += '  2. view.js: ä¿å­˜è§†å›¾è®¾ç½® (POST)\n';
            result += '  3. theme-config-manager.js: ä¿å­˜é»˜è®¤é…ç½® (POST)\n';
            result += '  4. theme-config-ui.js: ä¿å­˜åŒæ­¥é…ç½® (POST)\n';
            result += '  5. supabase-client.js: è¿æ¥æµ‹è¯• (SELECT)\n';
            result += '- æ€»è¯·æ±‚è€—æ—¶1280ms+\n';
            result += '- å¯¼è‡´é¡µé¢åŠ è½½ç¼“æ…¢\n\n';
            result += 'ä¿®å¤åçš„é¢„æœŸï¼š\n';
            result += '- æ–°ç”¨æˆ·ï¼š0æ¬¡Supabaseè¯·æ±‚\n';
            result += '- ç°æœ‰ç”¨æˆ·ï¼šåªæœ‰å¿…è¦çš„GETè¯·æ±‚ï¼ˆå¦‚æœéœ€è¦ï¼‰\n';
            result += '- æ€»åŠ è½½æ—¶é—´ä»1.28sé™è‡³0.1-0.2s\n';
            result += '- æ€§èƒ½æå‡95%ä»¥ä¸Š\n';
            
            resultDiv.textContent = result;
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ§ª Supabase fix test page loaded');
        });
    </script>
</body>
</html>
