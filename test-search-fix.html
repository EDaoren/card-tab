<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æœç´¢åŠŸèƒ½ä¿®å¤æµ‹è¯•</title>
  <link rel="stylesheet" href="styles/main.css">
  <link rel="stylesheet" href="fonts/material-symbols-rounded.css">
  <style>
    body {
      padding: 50px;
      background: #f5f5f5;
    }
    .test-info {
      background: white;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .test-info h3 {
      margin-top: 0;
      color: #333;
    }
    .status {
      padding: 10px;
      border-radius: 4px;
      margin: 10px 0;
    }
    .status.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .status.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .status.info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
  </style>
</head>
<body class="theme-default">
  <div class="test-info">
    <h3>ğŸ”§ æœç´¢åŠŸèƒ½ä¿®å¤æµ‹è¯•</h3>
    <p>æµ‹è¯•æœç´¢æ¡†è¾“å…¥å’Œæœç´¢å¼•æ“ä¸‹æ‹‰æ¡†åŠŸèƒ½</p>
    <div id="test-status" class="status info">
      æ­£åœ¨åˆå§‹åŒ–...
    </div>
  </div>

  <div class="search-container">
    <div class="search-box">
      <div class="search-input-row">
        <div class="search-engine-selector">
          <img src="https://www.google.com/favicon.ico" alt="Google" class="search-engine-icon">
          <span class="search-engine-dropdown">
            <span class="material-symbols-rounded">expand_more</span>
          </span>
          <!-- ä¸‹æ‹‰èœå• -->
          <div class="search-engine-dropdown-menu">
            <div class="search-engine-option" data-engine="0">
              <img src="https://www.google.com/favicon.ico" alt="Google">
              <span>Google</span>
            </div>
            <div class="search-engine-option" data-engine="1">
              <img src="https://www.bing.com/favicon.ico" alt="Bing">
              <span>Bing</span>
            </div>
            <div class="search-engine-option" data-engine="2">
              <img src="https://www.baidu.com/favicon.ico" alt="Baidu">
              <span>ç™¾åº¦</span>
            </div>
            <div class="search-engine-option" data-engine="3">
              <img src="https://duckduckgo.com/favicon.ico" alt="DuckDuckGo">
              <span>DuckDuckGo</span>
            </div>
          </div>
        </div>
        <div class="search-input-container">
          <input type="text" id="search-input" placeholder="è¾“å…¥'çŸ¥ä¹'æµ‹è¯•æœç´¢...">
        </div>
        <button class="search-button" type="button">
          <span class="material-symbols-rounded">search</span>
        </button>
      </div>
      <!-- æœç´¢ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
    </div>
  </div>

  <div class="test-info">
    <h3>ğŸ“‹ æµ‹è¯•æ­¥éª¤</h3>
    <ol>
      <li><strong>æµ‹è¯•æœç´¢å¼•æ“ä¸‹æ‹‰æ¡†ï¼š</strong>ç‚¹å‡»Googleå›¾æ ‡å·¦ä¾§åŒºåŸŸï¼Œåº”è¯¥èƒ½çœ‹åˆ°æœç´¢å¼•æ“é€‰é¡¹</li>
      <li><strong>æµ‹è¯•æœç´¢åŠŸèƒ½ï¼š</strong>åœ¨æœç´¢æ¡†ä¸­è¾“å…¥"çŸ¥ä¹"ï¼Œåº”è¯¥èƒ½çœ‹åˆ°æœç´¢ç»“æœä¸‹æ‹‰æ¡†</li>
      <li><strong>æµ‹è¯•åœ†è§’ï¼š</strong>æœç´¢ç»“æœæ˜¾ç¤ºæ—¶ï¼Œä¸‹æ‹‰æ¡†åº”è¯¥æœ‰å®Œæ•´çš„åº•éƒ¨åœ†è§’</li>
      <li><strong>æµ‹è¯•å¸ƒå±€ï¼š</strong>æœç´¢ç»“æœæ˜¾ç¤ºæ—¶ï¼Œä¸åº”è¯¥æŒ¤å‹ä¸‹é¢çš„å†…å®¹</li>
    </ol>
  </div>

  <script>
    // æ¨¡æ‹Ÿå­˜å‚¨ç®¡ç†å™¨
    const mockStorageManager = {
      data: {
        categories: [
          {
            id: 'cat-1',
            name: 'ç¤¾äº¤åª’ä½“',
            color: '#4285f4',
            shortcuts: [
              { id: 'shortcut-1', name: 'çŸ¥ä¹', url: 'https://zhihu.com' },
              { id: 'shortcut-2', name: 'å¾®åš', url: 'https://weibo.com' },
              { id: 'shortcut-3', name: 'å“”å“©å“”å“©', url: 'https://bilibili.com' }
            ]
          },
          {
            id: 'cat-2',
            name: 'å·¥ä½œ',
            color: '#0f9d58',
            shortcuts: [
              { id: 'shortcut-4', name: 'çŸ¥è¯†æ˜Ÿçƒ', url: 'https://zsxq.com' },
              { id: 'shortcut-5', name: 'è¯­é›€', url: 'https://yuque.com' }
            ]
          }
        ]
      },
      getCategories() {
        return this.data.categories;
      }
    };

    // è®¾ç½®å…¨å±€å˜é‡
    window.storageManager = mockStorageManager;

    // ç®€åŒ–çš„æœç´¢ç®¡ç†å™¨ç±»
    class TestSearchManager {
      constructor() {
        this.searchInput = document.getElementById('search-input');
        this.searchButton = document.querySelector('.search-button');
        this.searchEngineSelector = document.querySelector('.search-engine-selector');
        this.searchEngineIcon = document.querySelector('.search-engine-icon');
        this.searchBox = document.querySelector('.search-box');
        this.testStatus = document.getElementById('test-status');
        
        this.updateStatus('åˆå§‹åŒ–æœç´¢ç®¡ç†å™¨...', 'info');
        
        // åˆ›å»ºæœç´¢ç»“æœä¸‹æ‹‰æ¡†
        this.createSearchDropdown();
        
        // æœç´¢å¼•æ“é…ç½®
        this.searchEngines = [
          { name: 'Google', icon: 'https://www.google.com/favicon.ico' },
          { name: 'Bing', icon: 'https://www.bing.com/favicon.ico' },
          { name: 'Baidu', icon: 'https://www.baidu.com/favicon.ico' },
          { name: 'DuckDuckGo', icon: 'https://duckduckgo.com/favicon.ico' }
        ];

        this.currentSearchEngine = 0;
        this.bindEvents();
        this.updateSearchEngineIcon();
        
        this.updateStatus('âœ… æœç´¢ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆï¼ç°åœ¨å¯ä»¥æµ‹è¯•åŠŸèƒ½äº†ã€‚', 'success');
      }

      updateStatus(message, type) {
        this.testStatus.textContent = message;
        this.testStatus.className = `status ${type}`;
      }

      createSearchDropdown() {
        this.searchDropdown = document.createElement('div');
        this.searchDropdown.className = 'search-dropdown';
        this.searchDropdown.style.display = 'none';
        this.searchBox.appendChild(this.searchDropdown);
      }

      bindEvents() {
        // Search input events
        if (this.searchInput) {
          this.searchInput.addEventListener('input', (e) => {
            this.handleRealTimeSearch(e.target.value);
          });
          
          this.searchInput.addEventListener('focus', () => {
            if (this.searchInput.value.trim()) {
              this.showSearchDropdown();
            }
          });
          
          this.searchInput.addEventListener('blur', () => {
            setTimeout(() => {
              this.hideSearchDropdown();
            }, 150);
          });
        }

        // Search engine selector click
        if (this.searchEngineSelector) {
          this.searchEngineSelector.addEventListener('click', (e) => {
            e.stopPropagation();
            this.updateStatus('ğŸ”„ æœç´¢å¼•æ“é€‰æ‹©å™¨è¢«ç‚¹å‡»', 'info');
            this.toggleDropdown();
          });
        }

        // Search engine options click
        const engineOptions = document.querySelectorAll('.search-engine-option');
        engineOptions.forEach((option, index) => {
          option.addEventListener('click', (e) => {
            e.stopPropagation();
            const engineIndex = parseInt(option.dataset.engine);
            this.updateStatus(`âœ… é€‰æ‹©äº†æœç´¢å¼•æ“: ${this.searchEngines[engineIndex].name}`, 'success');
            this.selectSearchEngine(engineIndex);
          });
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', () => {
          this.closeDropdown();
        });
      }

      handleRealTimeSearch(query) {
        const trimmedQuery = query.trim().toLowerCase();
        
        if (!trimmedQuery) {
          this.hideSearchDropdown();
          return;
        }

        this.updateStatus(`ğŸ” æœç´¢: "${query}"`, 'info');
        this.showSearchResults(trimmedQuery);
      }

      showSearchResults(query) {
        if (!storageManager || !storageManager.data || !storageManager.data.categories) {
          this.renderSearchResults([]);
          this.showSearchDropdown();
          return;
        }
        
        const categories = storageManager.getCategories();
        let results = [];

        categories.forEach(category => {
          const matchingShortcuts = category.shortcuts.filter(shortcut =>
            shortcut.name.toLowerCase().includes(query)
          );

          matchingShortcuts.forEach(shortcut => {
            results.push({
              type: 'shortcut',
              data: shortcut,
              category: category,
              query: query
            });
          });
        });

        this.renderSearchResults(results);
        this.showSearchDropdown();
        
        if (results.length > 0) {
          this.updateStatus(`âœ… æ‰¾åˆ° ${results.length} ä¸ªåŒ¹é…ç»“æœ`, 'success');
        } else {
          this.updateStatus('â„¹ï¸ æœªæ‰¾åˆ°åŒ¹é…ç»“æœ', 'info');
        }
      }

      renderSearchResults(results) {
        if (results.length === 0) {
          this.searchDropdown.innerHTML = `
            <div class="search-result-item no-results">
              <span>æœªæ‰¾åˆ°åŒ¹é…ç»“æœ</span>
            </div>
          `;
          return;
        }

        this.searchDropdown.innerHTML = results.map(result => `
          <div class="search-result-item">
            <div class="result-content">
              <div class="result-title">${result.data.name}</div>
              <div class="result-subtitle">${result.category.name} â€¢ ${result.data.url}</div>
            </div>
          </div>
        `).join('');
      }

      showSearchDropdown() {
        this.searchDropdown.style.display = 'block';
        this.searchBox.classList.add('has-results');
      }

      hideSearchDropdown() {
        this.searchDropdown.style.display = 'none';
        this.searchBox.classList.remove('has-results');
      }

      toggleDropdown() {
        const isOpen = this.searchEngineSelector.classList.contains('open');
        
        if (isOpen) {
          this.closeDropdown();
        } else {
          this.searchEngineSelector.classList.add('open');
          this.updateActiveOption();
        }
      }

      closeDropdown() {
        this.searchEngineSelector.classList.remove('open');
      }

      selectSearchEngine(engineIndex) {
        this.currentSearchEngine = engineIndex;
        this.updateSearchEngineIcon();
        this.updateActiveOption();
        this.closeDropdown();
      }

      updateActiveOption() {
        const options = document.querySelectorAll('.search-engine-option');
        options.forEach((option, index) => {
          option.classList.toggle('active', index === this.currentSearchEngine);
        });
      }

      updateSearchEngineIcon() {
        if (this.searchEngineIcon) {
          const currentEngine = this.searchEngines[this.currentSearchEngine];
          this.searchEngineIcon.src = currentEngine.icon;
          this.searchEngineIcon.alt = currentEngine.name;
        }
        this.updateActiveOption();
      }
    }

    // ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆ
    document.addEventListener('DOMContentLoaded', () => {
      const testSearchManager = new TestSearchManager();
    });
  </script>
</body>
</html>
